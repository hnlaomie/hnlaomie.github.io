<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>hadoop installation</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">laomie blog </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/database.html">database</a></li>
                    <li><a href="/category/programming.html">programming</a></li>
                    <li><a href="/category/tools.html">tools</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/posts/2014/07/hadoop-installation/" rel="bookmark"
           title="Permalink to hadoop installation">hadoop installation</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-30T22:30:00+02:00">
                Published: 三 30 七月 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>. </p>
<p>tags: <a href="/tag/201407.html">201407</a> <a href="/tag/hadoop.html">hadoop</a> </p>
</footer><!-- /.post-info -->      <h2>安装必要的软件</h2>
<p>安装jdk和openssh并将hadoop解压到相关路径，此处为"/home/hduser/tools/hadoop"</p>
<h2>设置用户和组</h2>
<p>增加"hadoop"组和"hduser“用户</p>
<div class="highlight"><pre>sudo groupadd hadoop
sudo adduser --ingroup hadoop hduser
<span class="o">(</span>archlinux: sudo seradd -m -g hadoop -s /bin/bash hduser<span class="o">)</span>
sudo passwd hduser
</pre></div>


<h2>ssh设置</h2>
<div class="highlight"><pre>su - hduser
ssh-keygen -t rsa -P <span class="s2">&quot;&quot;</span>
cat <span class="nv">$HOME</span>/.ssh/id_rsa.pub &gt;&gt; <span class="nv">$HOME</span>/.ssh/authorized_keys
</pre></div>


<h2>禁用ipv6</h2>
<p>在"/etc/sysctl.conf"加入以下内容（注：archlinux为"/etc/sysctl.d/99-sysctl.conf"）</p>
<div class="highlight"><pre>#disable ipv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
</pre></div>


<h2>环境变量设置</h2>
<p>在"hduser“用户路径下的".bashrc”里加入以下内容</p>
<div class="highlight"><pre><span class="c"># Set Hadoop-related environment variables</span>
<span class="nb">export </span><span class="nv">HADOOP_HOME</span><span class="o">=</span>/home/hduser/tools/hadoop
<span class="c"># Native Path</span>
<span class="nb">export </span><span class="nv">HADOOP_COMMON_LIB_NATIVE_DIR</span><span class="o">=</span><span class="si">${</span><span class="nv">HADOOP_PREFIX</span><span class="si">}</span>/lib/native
<span class="nb">export </span><span class="nv">HADOOP_OPTS</span><span class="o">=</span><span class="s2">&quot;-Djava.library.path=</span><span class="nv">$HADOOP_PREFIX</span><span class="s2">/lib&quot;</span>
<span class="nb">export </span><span class="nv">JAVA_LIBRARY_PATH</span><span class="o">=</span><span class="si">${</span><span class="nv">HADOOP_PREFIX</span><span class="si">}</span>/lib/native 
<span class="c">#Java path</span>
<span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s1">&#39;/home/hduser/tools/jdk7&#39;</span>
<span class="c"># Add Hadoop bin/ directory to PATH</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HADOOP_HOME</span>/bin:<span class="nv">$JAVA_PATH</span>/bin:<span class="nv">$HADOOP_HOME</span>/sbin
</pre></div>


<h2>建hadoop的数据目录和临时目录</h2>
<div class="highlight"><pre><span class="nb">source</span> ~/.bashrc
mkdir -p <span class="nv">$HADOOP_HOME</span>/yarn_data/hdfs/namenode
mkdir -p <span class="nv">$HADOOP_HOME</span>/yarn_data/hdfs/datanode
mkdir -p <span class="nv">$HADOOP_HOME</span>/tmp
</pre></div>


<h2>hadoop配置文件设置</h2>
<p>1. 为"libexec/hadoop-config.sh"设置"JAVA_HOME"</p>
<div class="highlight"><pre><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s1">&#39;/home/hduser/tools/jdk7&#39;</span>
</pre></div>


<p>2. 为"etc/hadoop/hadoop-env.sh"设置"JAVA_HOME"</p>
<div class="highlight"><pre><span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span><span class="s1">&#39;/home/hduser/tools/jdk7&#39;</span>
</pre></div>


<p>3. 设置"etc/hadoop/yarn-site.xml"</p>
<div class="highlight"><pre><span class="nt">&lt;configuration&gt;</span>
    <span class="c">&lt;!-- Site specific YARN configuration properties --&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>mapreduce_shuffle<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services.mapreduce.shuffle.class<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>org.apache.hadoop.mapred.ShuffleHandler<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="c">&lt;!-- &quot;laomie-pc&quot; is master node hostname --&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.resourcemanager.resource-tracker.address<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>laomie-pc:8025<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.resourcemanager.scheduler.address<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>laomie-pc:8030<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.resourcemanager.address<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>laomie-pc:8040<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<p>4. 设置"etc/hadoop/core-site.xml"</p>
<div class="highlight"><pre><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>fs.default.name<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>hdfs://localhost:9000<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>hadoop.tmp.dir<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>/home/hduser/tools/hadoop/tmp<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>hadoop.native.lib<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<p>5. 设置"etc/hadoop/mapred-site.xml" （注：mapred-site.xml.template生成mapred-site.xml）</p>
<div class="highlight"><pre><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>mapreduce.framework.name<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>yarn<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<p>6. 设置"etc/hadoop/hdfs-site.xml"</p>
<div class="highlight"><pre><span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.replication<span class="nt">&lt;/name&gt;</span>
        <span class="c">&lt;!-- the number of nodes --&gt;</span>
        <span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.namenode.name.dir<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>file:/home/hduser/tools/hadoop/yarn_data/hdfs/namenode<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.datanode.data.dir<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>file:/home/hduser/tools/hadoop/yarn_data/hdfs/datanode<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.permissions<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<h2>hadoop名称节点格式化</h2>
<div class="highlight"><pre>hdfs namenode -format
</pre></div>


<h2>hadoop的启动，停止</h2>
<div class="highlight"><pre>start-dfs.sh
start-yarn.sh
stop-yarn.sh
stop-dfs.sh
</pre></div>


<h2>hadoop服务</h2>
<ul>
<li>
<p>namenode (50070)</p>
</li>
<li>
<p>cluster and applications  (8088)</p>
</li>
<li>
<p>secondary namenode  (50090)</p>
</li>
<li>
<p>datanode (50075)</p>
</li>
</ul>
<h2>多节点hadoop设置</h2>
<p>在"/etc/hosts"设置主从节点机</p>
<div class="highlight"><pre>192.168.1.12  laomie-pc
192.168.1.11  slave01
</pre></div>


<p>主节点机"laomie-pc"ssh登录从节点机"slave01"的设置（注：所有从节点机都需设置）</p>
<div class="highlight"><pre>ssh-copy-id -i /home/hduser/.ssh/id_rsa.pub hduser@slave01
</pre></div>


<p>在主节点机的hadoop配置"$HADOOP_CONF_DIR/slaves"中添加从节点机</p>
<div class="highlight"><pre>slave01
</pre></div>


<h2>hadoop的代码编译 (archlinux)</h2>
<p>安装下列依赖软件</p>
<div class="highlight"><pre>sudo pacman -S cmake apache-ant base-devel protobuf maven
ln -s /etc/profile.d/jre.sh /etc/profile.d/jdk.sh
sudo yaourt -S findbugs
</pre></div>


<p>修改~/.bashrc</p>
<div class="highlight"><pre><span class="nb">export </span><span class="nv">FINDBUGS_HOME</span><span class="o">=</span>/opt/findbugs
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$FINDBUGS_HOME</span>/bin
</pre></div>


<p>编译hadoop</p>
<div class="highlight"><pre>mvn package -Pdist,native,docs,src -DskipTests -Dtar
</pre></div>


<h2>hadoop的代码编译 (ubuntu)</h2>
<p>安装下列依赖软件</p>
<div class="highlight"><pre><span class="nv">$ </span>sudo add-apt-repository ppa:webupd8team/java
<span class="nv">$ </span>sudo apt-get --yes install openjdk-7-jdk subversion pkg-config libssl-dev git ant maven cmake build-essential zlib1g-dev lib32z1-dev libsnappy-dev oracle-java8-installer
</pre></div>


<p>安装protobuf2.5.0</p>
<div class="highlight"><pre><span class="nv">$ </span>./configure
<span class="nv">$ </span>make
<span class="nv">$ </span>make check
<span class="nv">$ </span>sudo make install
<span class="nv">$ </span>sudo ldconfig
</pre></div>


<p>安装findbugs3.0.0
* 解压并如上设置环境变量</p>
<p>jdk8编译hadoop （注：不能编译doc）</p>
<div class="highlight"><pre>mvn package -Pdist,native -DskipTests -Dtar -Dmaven.javadoc.skip<span class="o">=</span><span class="nb">true</span> 
</pre></div>


<h2>references</h2>
<ul>
<li><a href="http://www.cnblogs.com/lanxuezaipiao/p/3525554.html">http://www.cnblogs.com/lanxuezaipiao/p/3525554.html</a></li>
<li><a href="http://solaimurugan.blogspot.com/2013/11/setup-multi-node-hadoop-20-cluster.html">http://solaimurugan.blogspot.com/2013/11/setup-multi-node-hadoop-20-cluster.html</a></li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>