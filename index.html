<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>laomie's blog</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">laomie's blog </a></h1>
                <nav><ul>
                    <li><a href="/category/database.html">database</a></li>
                    <li><a href="/category/programming.html">programming</a></li>
                    <li><a href="/category/tools.html">tools</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/posts/2016/12/tez-installation/">tez installation</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-12-01T09:50:00+08:00">
                Published: 2016-12-01(四)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/hnlaomie.html">hnlaomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201612.html">201612</a> <a href="/tag/tez.html">tez</a> <a href="/tag/hadoop.html">hadoop</a> <a href="/tag/hive.html">hive</a> </p>
</footer><!-- /.post-info --><h1>代码编译</h1>
<p>修改代码里最顶层的"pom.xml"，将hadoop版本改为和运行的一致，注掉node.js相关代码</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;hadoop.version&gt;</span>2.7.3<span class="nt">&lt;/hadoop.version&gt;</span>

<span class="c">&lt;!--</span>
<span class="c">    &lt;module&gt;tez-ui&lt;/module&gt;</span>
<span class="c">    &lt;module&gt;tez-ui2&lt;/module&gt;</span>
<span class="c">--&gt;</span>
</pre></div>


<p>编译代码（需要预先编译Protocol Buffers 2.5.0）</p>
<div class="highlight"><pre><span></span>mvn clean package -DskipTests=true -Dmaven.javadoc.skip=true
</pre></div>


<h1>安装</h1>
<p>在hdfs建目录，并将tez复制到新建的目录</p>
<div class="highlight"><pre><span></span>hdfs dfs -mkdir /apps/tez
hdfs dfs -copyFromLocal tez-dist/target/tez-0.8.4.tar.gz /apps/tez/
</pre></div>


<p>所有结点本地安装tez</p>
<div class="highlight"><pre><span></span>mkdir -p /data/apache/tez
tar -xvzf tez-dist/target/tez-0.8.4-minimal.tar.gz -C /data/apache/tez
</pre></div>


<h1>环境变量设置（所有结点）</h1>
<p>~/.bashrc设置"TEZ_HOME"和"TEZ_CONF_DIR"</p>
<div class="highlight"><pre><span></span><span class="x">export TEZ_HOME=/data/apache/tez</span>
<span class="x">export TEZ_CONF_DIR=</span><span class="p">$</span><span class="nv">TEZ_HOME</span><span class="x">/conf</span>
</pre></div>


<p>$HADOOP_HOME/etc/hadoop/hadoop-env.sh设置"HADOOP_CLASSPATH"</p>
<div class="highlight"><pre><span></span>export HADOOP_CLASSPATH=<span class="cp">${</span><span class="n">TEZ_CONF_DIR</span><span class="cp">}</span>:<span class="cp">${</span><span class="n">TEZ_HOME</span><span class="cp">}</span>/*:<span class="cp">${</span><span class="n">TEZ_HOME</span><span class="cp">}</span>/lib/*
</pre></div>


<h1>hadoop, tez, hive配置</h1>
<p>$HADOOP_HOME/etc/hadoop/mapred-site.xml设置"mapreduce.framework.name"</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>mapreduce.framework.name<span class="nt">&lt;/name&gt;</span>
    <span class="c">&lt;!--&lt;value&gt;yarn&lt;/value&gt;--&gt;</span>
    <span class="nt">&lt;value&gt;</span>yarn-tez<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>


<p>$HIVE_HOME/conf/hive-site.xml增加以下设置</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>hive.execution.engine<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>tez<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>hive.prewarm.enabled<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>hadoop.embedded.local.mode<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>


<p>$TEZ_HOME/conf/tez-site.xml设置</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>tez.version<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>tez-0.8.4<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>tez.use.cluster.hadoop-libs<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>tez.lib.uris<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>${fs.defaultFS}/apps/tez/${tez.version}.tar.gz<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<p>将$TEZ_HOME/conf/tez-site.xml复制到所有结点的"$HADOOP_HOME/etc/hadoop"目录</p>
<h1>tez测试</h1>
<p>运行测试例子</p>
<div class="highlight"><pre><span></span><span class="x">hadoop jar </span><span class="p">$</span><span class="nv">TEZ_HOME</span><span class="x">/tez-examples.jar orderedwordcount &lt;input&gt; &lt;output&gt;</span>
<span class="x">hadoop jar </span><span class="p">$</span><span class="nv">TEZ_HOME</span><span class="x">/tez-tests.jar testorderedwordcount &lt;input1&gt; &lt;output1&gt; &lt;input2&gt; &lt;output2&gt; ...</span>
</pre></div>


<h1>问题一览</h1>
<ol>
<li>spark用yarn跑时，找不着tez，可将$SPARK_HOME/conf/hive-site.xml的tez改为mr方式</li>
</ol>
<div class="highlight"><pre><span></span><span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>hive.execution.engine<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;value&gt;</span>mr<span class="nt">&lt;/value&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</pre></div>


<p>脚本中用以下方式运行spark-submit</p>
<div class="highlight"><pre><span></span><span class="nv">files</span><span class="o">=</span><span class="s2">&quot;/data/apache/spark/conf/hive-site.xml&quot;</span>
spark-submit --files <span class="si">${</span><span class="nv">files</span><span class="si">}</span>
</pre></div>


<h1>参考</h1>
<ul>
<li><a href="http://tez.apache.org/install.html">http://tez.apache.org/install.html</a></li>
</ul>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/11/postgresql-installation/" rel="bookmark"
                           title="Permalink to postgresql installation">postgresql installation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-11-24T10:10:00+08:00">
                Published: 2016-11-24(四)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201611.html">201611</a> <a href="/tag/pgsql.html">pgsql</a> </p>
</footer><!-- /.post-info -->                <p>postgresql installation</p>
                <a class="readmore" href="/posts/2016/11/postgresql-installation/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/11/python-tips/" rel="bookmark"
                           title="Permalink to python tips">python tips</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-11-09T10:30:00+08:00">
                Published: 2016-11-09(三)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/programming.html">programming</a>.</p>
<p>tags: <a href="/tag/201611.html">201611</a> <a href="/tag/python.html">python</a> </p>
</footer><!-- /.post-info -->                <p>python tips</p>
                <a class="readmore" href="/posts/2016/11/python-tips/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/09/presto-installation/" rel="bookmark"
                           title="Permalink to presto installation">presto installation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-09-28T17:50:00+08:00">
                Published: 2016-09-28(三)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/hnlaomie.html">hnlaomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201609.html">201609</a> <a href="/tag/presto.html">presto</a> <a href="/tag/hadoop.html">hadoop</a> </p>
</footer><!-- /.post-info -->                <p>presto安装</p>
                <a class="readmore" href="/posts/2016/09/presto-installation/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/07/r-installation/" rel="bookmark"
                           title="Permalink to r installation">r installation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-07-14T07:30:00+08:00">
                Published: 2016-07-14(四)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/programming.html">programming</a>.</p>
<p>tags: <a href="/tag/201607.html">201607</a> <a href="/tag/r.html">r</a> </p>
</footer><!-- /.post-info -->                <p>r的安装</p>
                <a class="readmore" href="/posts/2016/07/r-installation/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/07/hive-tips/" rel="bookmark"
                           title="Permalink to hive tips">hive tips</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-07-01T13:00:00+08:00">
                Published: 2016-07-01(五)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201607.html">201607</a> <a href="/tag/hadoop.html">hadoop</a> <a href="/tag/hive.html">hive</a> </p>
</footer><!-- /.post-info -->                <p>hive使用指南</p>
                <a class="readmore" href="/posts/2016/07/hive-tips/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/01/cassandra-installation/" rel="bookmark"
                           title="Permalink to cassandra installation">cassandra installation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-01-11T10:50:00+08:00">
                Published: 2016-01-11(一)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201601.html">201601</a> <a href="/tag/cassandra.html">cassandra</a> </p>
</footer><!-- /.post-info -->                <p>cassandra安装</p>
                <a class="readmore" href="/posts/2016/01/cassandra-installation/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2016/01/spark-tips/" rel="bookmark"
                           title="Permalink to spark tips">spark tips</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-01-09T16:30:00+08:00">
                Published: 2016-01-09(六)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/laomie.html">laomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201601.html">201601</a> <a href="/tag/spark.html">spark</a> </p>
</footer><!-- /.post-info -->                <p>spark使用指南</p>
                <a class="readmore" href="/posts/2016/01/spark-tips/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2015/12/kafka-installation/" rel="bookmark"
                           title="Permalink to kafka installation">kafka installation</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-12-18T09:50:00+08:00">
                Published: 2015-12-18(五)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/hnlaomie.html">hnlaomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201512.html">201512</a> <a href="/tag/kafka.html">kafka</a> <a href="/tag/zookeeper.html">zookeeper</a> <a href="/tag/hadoop.html">hadoop</a> </p>
</footer><!-- /.post-info -->                <p>kafka安装</p>
                <a class="readmore" href="/posts/2015/12/kafka-installation/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="/posts/2015/12/hadoop-links/" rel="bookmark"
                           title="Permalink to hadoop links">hadoop links</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-12-16T11:30:00+08:00">
                Published: 2015-12-16(三)
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/hnlaomie.html">hnlaomie</a>
        </address>
<p>In <a href="/category/database.html">database</a>.</p>
<p>tags: <a href="/tag/201512.html">201512</a> <a href="/tag/hadoop.html">hadoop</a> </p>
</footer><!-- /.post-info -->                <p>hadoop资源链接</p>
                <a class="readmore" href="/posts/2015/12/hadoop-links/">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 4
        <a href="/index2.html">&raquo;</a>
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="https://hnlaomie.github.io">laomie's blog</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>